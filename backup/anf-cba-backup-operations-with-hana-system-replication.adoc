---
sidebar: sidebar 
permalink: backup/anf-cba-backup-operations-with-hana-system-replication.html 
keywords: system replication, cba, hsr, multiple host, standby host 
summary: 本節說明如何使用HANA系統複寫來執行備份作業。 
---
= 利用HANA系統複寫進行備份作業
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-restore-and-recovery-from-snapshot-backup.html["先前：從Snapshot備份還原與還原。"]



== 儲存Snapshot備份與HANA系統複寫

備份作業一律會在主要SAP HANA主機執行、因為備份作業所需的SQL命令無法在次要SAP HANA主機上執行。

對於SAP HANA備份作業、主要和次要SAP HANA主機是單一實體。他們共享相同的SAP HANA備份目錄、無論備份是在主要或次要SAP HANA主機上建立、都會使用備份來進行還原和還原。

若要使用任何備份進行還原、以及使用兩個主機的記錄備份來進行轉送恢復、則需要可從兩個主機存取的共用記錄備份位置。NetApp建議您使用共享的儲存磁碟區。不過、您也應該將記錄備份目的地分隔成共享磁碟區內的子目錄。

每個SAP HANA主機都有自己的儲存磁碟區。當您使用儲存型Snapshot來執行備份時、會在主要SAP HANA主機的儲存Volume上建立資料庫一致的Snapshot複本。

image:anf-cba-image102.png["此圖顯示如何在主要SAP HANA主機的儲存Volume上建立資料庫一致的Snapshot複本。"]

執行容錯移轉至主機2時、主機2會成為主要SAP HANA主機、備份會在主機2執行、並在主機2的儲存磁碟區建立Snapshot備份。

在主機2上建立的備份可直接在儲存層還原。如果您必須使用在主機1上建立的備份、則必須將備份從主機1儲存磁碟區複製到主機2儲存磁碟區。轉送恢復會使用來自兩個主機的記錄備份。

image:anf-cba-image103.png["此圖顯示轉送恢復如何使用兩台主機的記錄備份。"]



== 利用支援CBA和HSR的HANA系統進行備份作業

如前一節所述、您必須考量幾件與採用HSR技術的HANA系統搭配進行備份作業的事項。

* 備份作業只能在主要HANA主機上執行。因此、在執行備份作業時、CBA必須知道目前哪個主機是主要主機。
+
** 必須針對目前的主要主機執行備份SQL陳述式。
** Snapshot備份只能在主要主機資料磁碟區進行、因為次要主機資料磁碟區的狀態不一致、因此無法進行還原與還原作業。


* Snapshot備份的保留管理必須跨兩個主機執行。例如、當執行容錯移轉至次要主機時、也必須根據定義的所有層級保留、在CBA、anf磁碟區和HANA備份目錄中刪除前主要主機的備份。否則、由於舊資料備份、會封鎖根據記錄備份保留管理刪除舊的記錄備份。


在CBA中、主要和次要HANA主機的設定方式都與一般HANA系統相同、如下圖所示。組態設定時唯一的差異在於勾選核取方塊、告知CBA此HANA系統屬於HSR ralationShip的一部分。CBA會從主機讀取HSR狀態、然後找出哪些主機屬於一起、哪些主機屬於一線或二線主機。在內部CBA中、這兩個主機會視為單一實體、只會針對目前的主要主機執行備份、並在兩個主機之間執行保留管理。


NOTE: CBA僅支援雙主機組態的HSR。

image:anf-cba-image104.png["本圖顯示CBA如何僅支援雙主機組態的HSR。"]



== 安裝與組態步驟總覽

啟用HSR的HANA系統所需的組態步驟有一些小差異。在本節中、我們只強調與先前所述標準組態步驟相比的差異。

. 在主要HSR主機的HANA系統資料庫中建立備份使用者。
. 在Cloud Backup for Applications中新增主要主機並設定HANA系統。
+
.. 在組態期間選取* HANA System Replication *。
+
image:anf-cba-image105.png["正在完成步驟的快照。"]

.. 增加主主機的儲存佔用空間。
+
image:anf-cba-image106.png["正在完成步驟的快照。"]



. 新的HANA系統現在列有HSR圖示。
+
image:anf-cba-image107.png["正在完成步驟的快照。"]

. 在Cloud Backup for Applications中新增次要主機並設定HANA系統。
+
.. 在組態期間選取* HANA System Replication *。
+
image:anf-cba-image108.png["正在完成步驟的快照。"]

.. 增加二線主機的儲存佔用空間。
+
image:anf-cba-image109.png["正在完成步驟的快照。"]

+
這兩個系統現在都會顯示HSR圖示。

+
image:anf-cba-image110.png["正在完成步驟的快照。"]



. 將備份原則新增至主要和次要HANA系統。
+

NOTE: 您必須將相同的原則新增至兩個系統、因為保留管理是在兩個HANA主機之間執行。



現在、備份是根據定義的原則執行。CBA一律會在主要HANA主機上觸發Snapshot備份作業。

link:anf-cba-backup-operations-with-hana-multiple-host-systems.html["下一步：使用HANA多主機系統進行備份作業。"]
