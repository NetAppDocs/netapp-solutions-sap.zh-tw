---
sidebar: sidebar 
permalink: backup/saphana-dr-anf_disaster_recovery_solution_comparison.html 
keywords: sap, hana, system, replication, data, memory, disaster, recovery, solutions, azure 
summary: 全方位的災難恢復解決方案必須能讓客戶從主要站台的完整故障中恢復。 
---
= 災難恢復解決方案比較
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


[role="lead"]
全方位的災難恢復解決方案必須能讓客戶從主要站台的完整故障中恢復。因此、資料必須傳輸至次要站台、而且在站台故障時、必須有完整的基礎架構才能執行必要的正式作業SAP HANA系統。視應用程式的可用度需求和您想要保護的災難類型而定、必須考慮採用雙站台或三站台災難恢復解決方案。

下圖顯示一般組態、其中資料會在同一個Azure區域內同步複寫到第二個可用區域。短距離可讓您同步複寫資料、以達到零的RPO（通常用於提供HA）。

此外、當主要區域受到影響時、資料也會以非同步方式複寫到次要區域、以避免災難發生。可達成的最低RPO取決於資料複寫頻率、而資料複寫頻率則受限於主要區域與次要區域之間的可用頻寬。一般而言、最小RPO介於20分鐘到多小時之間。

本文件討論兩區災難恢復解決方案的不同實作選項。

image::saphana-dr-anf_image3.png[saphana Dr anf image3.]



== SAP HANA系統複寫

SAP HANA系統複寫可在資料庫層運作。此解決方案是以災難恢復站台額外的SAP HANA系統為基礎、從主要系統接收變更。此二線系統必須與一線系統相同。

SAP HANA系統複寫可在下列兩種模式之一中操作：

* 在災難恢復網站上預先載入記憶體和專屬伺服器的資料：
+
** 該伺服器僅作為SAP HANA系統複寫次要主機使用。
** RTO值極低、因為資料已載入記憶體、而且在容錯移轉時不需要啟動資料庫。


* 在災難恢復網站上、如果資料未預先載入記憶體和共享伺服器：
+
** 該伺服器可作為SAP HANA系統複寫二線系統共享、也可作為開發/測試系統共享。
** RTO主要取決於啟動資料庫並將資料載入記憶體所需的時間。




如需所有組態選項和複寫案例的完整說明、請參閱 https://help.sap.com/saphelp_hanaplatform/helpdata/en/67/6844172c2442f0bf6c8b080db05ae7/content.htm?frameset=/en/52/08b5071e3f45d5aa3bcbb7fde10cec/frameset.htm&current_toc=/en/00/0ca1e3486640ef8b884cdf1a050fbb/plain.htm&node_id=527&show_children=f["SAP HANA系統管理指南"^]。

下圖顯示使用SAP HANA系統複寫的兩區災難恢復解決方案設定。在同一個Azure區域中、預先載入記憶體中資料的同步複寫會用於本機HA、但會在不同的可用性區域中執行。未預先載入資料的非同步複寫是針對遠端災難恢復區域所設定。

下圖說明SAP HANA系統複寫。

image::saphana-dr-anf_image4.png[saphana Dr anf Image4.]



=== SAP HANA系統複寫、並預先載入記憶體中的資料

SAP HANA的RTO值非常低、只能透過預先載入記憶體資料的SAP HANA系統複寫來達成。在災難恢復站台使用專屬的次要伺服器來操作SAP HANA系統複寫、可實現約1分鐘或更短的RTO值。複寫的資料會接收並預先載入次要系統的記憶體中。由於容錯移轉時間極短、SAP HANA系統複寫也常用於幾乎零停機的維護作業、例如HANA軟體升級。

SAP HANA系統複寫通常設定為在選擇資料預先載入時同步複寫。同步複寫支援的最大距離為100公里。



=== SAP系統複寫、不需預先載入記憶體中的資料

為了滿足較不嚴苛的RTO要求、您可以使用SAP HANA系統複寫、而無需預先載入資料。在此作業模式中、災難恢復區域的資料不會載入記憶體。DR區域的伺服器仍可用來處理執行所有必要SAP HANA程序的SAP HANA系統複寫。不過、伺服器的大部分記憶體都可用於執行其他服務、例如SAP HANA開發/測試系統。

發生災難時、開發/測試系統必須關機、必須啟動容錯移轉、而且必須將資料載入記憶體。這種冷待機方法的RTO取決於資料庫的大小、以及在資料列和資料行儲存區負載期間的讀取處理量。假設資料的讀取處理量為1000Mbps、則載入1TB的資料大約需要18分鐘。



== SAP HANA災難恢復搭配ANF跨區域複寫

ANF跨區域複寫是以非同步資料複寫的災難恢復解決方案、內建於ANF中。ANF跨區域複寫是透過主要和次要Azure區域上兩個ANF磁碟區之間的資料保護關係來設定。ANF跨區域複寫會使用有效的區塊差異複寫來更新次要Volume。更新排程可在複寫組態期間定義。

下圖顯示使用ANF跨區域複寫的兩區災難恢復解決方案範例。在本例中、HANA系統受到上一章所述主要區域內HANA系統複寫的保護。複寫到次要區域時、會使用ANF跨區域複寫來執行。RPO是由複寫排程和複寫選項所定義。

RTO主要取決於在災難恢復站台啟動HANA資料庫、以及將資料載入記憶體所需的時間。假設資料的讀取處理量為1000 MB/s、載入1TB的資料大約需要18分鐘。視複寫組態而定、也需要轉送還原、並會增加RTO總值。

有關不同組態選項的詳細資訊、請參閱一章 link:ent-apps-db/saphana-dr-anf_anf_cross-region_replication_with_sap_hana_overview.html["使用SAP HANA進行跨區域複寫的組態選項"]。

災難恢復站台的伺服器可在正常運作期間作為開發/測試系統使用。發生災難時、開發/測試系統必須關閉、並以DR正式作業伺服器的形式啟動。

ANF跨區域複寫可讓您在不影響RPO和RTO的情況下測試DR工作流程。這是透過建立磁碟區複製並將其附加至DR測試伺服器來達成的。

image::saphana-dr-anf_image5.png[saphana Dr anf 影像 5.]



== 災難恢復解決方案摘要

下表比較本節所討論的災難恢復解決方案、並強調最重要的指標。

主要調查結果如下：

* 如果需要極低的RTO、則只能使用預先載入記憶體的SAP HANA系統複寫。
+
** DR站台需要專用伺服器來接收複寫的資料、並將資料載入記憶體。


* 此外、位於資料庫外部的資料（例如共享檔案、介面等）也需要進行儲存複寫。
* 如果RTO/RPO要求較不嚴格、則Anf跨區域複寫也可用於：
+
** 結合資料庫與非資料庫資料複寫。
** 涵蓋其他使用案例、例如災難恢復測試和開發/測試更新。
** 透過儲存複寫、DR站台的伺服器可在正常運作期間作為QA或測試系統使用。


* SAP HANA系統複寫與RPO=0的HA解決方案結合、加上長距離的儲存複寫功能、可滿足不同的需求。


下表提供災難恢復解決方案的比較。

|===
|  | 儲存複寫 2+| SAP HANA系統複寫 


|  | *跨區域複寫* | *含資料預先載入* | *不含資料預先載入* 


| RTO | 從低到中、視資料庫啟動時間和轉送恢復而定 | 非常低 | 從低到中、視資料庫啟動時間而定 


| RPO | RPO > 20分鐘的非同步複寫 | RPO > 20分鐘非同步複寫RPO = 0同步複寫 | RPO > 20分鐘非同步複寫RPO = 0同步複寫 


| DR站台的伺服器可用於開發/測試 | 是的 | 否 | 是的 


| 複寫非資料庫資料 | 是的 | 否 | 否 


| DR資料可用於更新開發/測試系統 | 是的 | 否 | 否 


| 災難恢復測試、不影響RTO和RPO | 是的 | 否 | 否 
|===