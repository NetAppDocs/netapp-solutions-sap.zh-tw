---
sidebar: sidebar 
permalink: backup/anf-cba-backup-and-recovery-using-azure-netapp-files.html 
keywords: runtime, backup, recovery, restore, recover 
summary: 您可以使用Azure NetApp Files Snapshot（anf）Snapshot快照技術、在數秒內建立資料庫備份。建立Snapshot複本所需的時間與資料庫大小無關、因為Snapshot複本不會在儲存平台上移動任何實體資料區塊。此外、使用Snapshot技術也不會影響即時SAP系統的效能。 
---
= 使用Azure NetApp Files 支援功能進行備份與恢復
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


link:anf-cba-overview.html["上一步：總覽。"]

[role="lead"]
您可以使用Azure NetApp Files Snapshot（anf）Snapshot快照技術、在數秒內建立資料庫備份。建立Snapshot複本所需的時間與資料庫大小無關、因為Snapshot複本不會在儲存平台上移動任何實體資料區塊。此外、使用Snapshot技術也不會影響即時SAP系統的效能。因此、您可以排程建立Snapshot複本、而不需考慮尖峰對話或批次活動期間。SAP on anf客戶通常會在一天內排程多個線上Snapshot備份、例如、每四到六個小時就很常見。這些Snapshot備份通常會在主要儲存系統上保留三到五天、然後再移除。

Snapshot複本也為還原與還原作業提供重要優勢。Volume還原作業可根據可用的Snapshot複本、將整個資料庫還原至任何時間點。這類還原程序只需幾秒鐘就能完成、不受資料庫大小限制。由於每天都會建立數個線上Snapshot備份、因此相較於傳統備份方法、還原程序所需的時間會大幅縮短。由於只需幾小時（而非最多24小時）的Snapshot複本即可執行還原作業、因此必須套用較少的交易記錄。因此、RTO縮短至數分鐘、而非傳統單週期備份所需的數小時。

Snapshot複本備份與作用中的線上資料儲存在相同的磁碟系統上。因此、NetApp建議使用Snapshot複本備份做為補充、而非取代次要位置的備份。大部分的還原和還原動作都是使用主儲存系統上的Volume Revert作業來處理。只有當包含Snapshot複本的主要儲存系統毀損時、才需要從次要位置進行還原。如果需要還原Snapshot複本不再提供的備份、您可以使用次要位置。

您可以使用額外的HANA檔案型備份來備份到次要位置。這些檔案型備份的排程頻率較低、因此對正式作業系統效能的影響較小。



== Snapshot備份與還原作業的執行時間

下圖顯示客戶使用Snapshot備份作業的HANA Studio。映像顯示HANA資料庫（大小約4TB）使用Snapshot備份技術、在1分鐘20秒內備份、而使用檔案型備份作業則需4小時以上。

整體備份工作流程執行時間最大的一部分是執行HANA備份儲存點作業所需的時間、而此步驟則取決於HANA資料庫的負載。儲存Snapshot備份本身一律會在幾秒鐘內完成。

image:anf-cba-image1.png["此圖顯示客戶使用Snapshot備份作業的HANA Studio。"]



== 恢復時間目標比較

本節提供檔案型與儲存型Snapshot備份的還原時間目標（RTO）比較。RTO是根據還原、還原及啟動資料庫所需的時間總和來定義。



=== 還原資料庫所需的時間

使用檔案型備份時、還原時間取決於資料庫和備份基礎架構的大小、而備份基礎架構會以每秒MB為單位來定義還原速度。例如、如果基礎架構支援以250Mbps速度還原作業、則還原持續性資料庫時、大約需要4.5小時的時間、以4TB為單位。

有了儲存Snapshot複本備份、還原時間不受資料庫大小限制、而且一律在數秒內完成。



=== 啟動資料庫所需的時間

資料庫開始時間取決於資料庫的大小、以及將資料載入記憶體所需的時間。在下列範例中、假設資料可以以1000Mbps載入。將4TB載入記憶體約需1小時10分鐘。檔案型與Snapshot型還原與還原作業的開始時間相同。


NOTE: 有了這個功能、就能動態調整Volume處理量Azure NetApp Files 。在HANA啟動之前、HANA資料磁碟區的處理量可在HANA資料庫啟動後增加並減少至每日作業值。



=== 恢復資料庫所需的時間

恢復時間取決於還原後必須套用的記錄數目。此數字取決於資料備份的頻率。

使用檔案型資料備份時、備份排程通常每天一次。備份頻率通常無法提高、因為備份會降低正式作業效能。因此、在最糟的情況下、一天內寫入的所有記錄都必須在轉送恢復期間套用。

Snapshot備份通常會以較高的頻率排程、因為它們不會影響SAP HANA資料庫的效能。例如、如果每六小時排程一次Snapshot備份、則在最糟的情況下、還原時間是檔案型備份的恢復時間（6小時/ 24小時= 0.25）的四分之一。

下圖顯示每日檔案型備份與Snapshot備份的還原與還原作業與不同排程的比較。

前兩個長條圖顯示、即使每天只有一次Snapshot備份、由於Snapshot備份的還原作業速度加快、還原與還原作業也會減少到43%。如果每天建立多個Snapshot備份、則可進一步減少執行時間、因為在轉送還原期間需要套用的記錄較少。

下圖也顯示每天四到六個Snapshot備份最合理、因為較高的頻率不會對整體執行時間造成重大影響。

image:anf-cba-image2.png["此圖顯示每日檔案型備份與Snapshot備份的還原與還原作業與不同排程的比較。"]

link:anf-cba-use-cases-and-value-of-accelerated-backup-and-cloning-operations_overview.html["下一步：加速備份與複製作業的使用案例和價值。"]
